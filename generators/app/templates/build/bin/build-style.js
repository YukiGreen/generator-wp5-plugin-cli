var Components = require('../../components.json');
var fs = require('fs');
var render = require('json-templater/string');
var path = require('path');
var endOfLine = require('os').EOL;

var OUTPUT_PATH = path.join(__dirname, '../../src/styles/componentsIndex.less');
var IMPORT_TEMPLATE = '@import \'../../packages/{{package}}/index.less\';'; 
var MAIN_TEMPLATE = `/* Automatically generated by './build/bin/build-style.js' */
{{include}}
`;

delete Components.font;
function fileExists(filePath) {
  try {
    return fs.statSync(filePath).isFile();
  } catch (err) {
    return false;
  }
}
var ComponentNames = Object.keys(Components);

var includeComponentTemplate = [];

ComponentNames.forEach(name => {
  var filePath = path.resolve(__dirname, "../../packages/" + name + "/index.less");
  if (fileExists(filePath)) { 
    includeComponentTemplate.push(render(IMPORT_TEMPLATE, {
      package: name
    }));
  }
});

var template = render(MAIN_TEMPLATE, {
  include: includeComponentTemplate.join(endOfLine),
});

fs.writeFileSync(OUTPUT_PATH, template);